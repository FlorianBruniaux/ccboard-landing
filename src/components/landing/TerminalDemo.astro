---
// Terminal animation: typing effect cycling through ccboard command scenes
const scenes = [
  {
    command: 'ccboard',
    output: [
      '  Dashboard loaded: 847 sessions, 9 tabs ready',
      '  Cost: $42.18/month │ Cache: 99.7% hit rate',
      '  Press 1-9 to navigate, ? for help',
    ],
  },
  {
    command: 'ccboard search "refactor auth"',
    output: [
      '  Found 3 sessions matching "refactor auth"',
      '  → 2026-02-14 refactor-auth-middleware (45min, $2.30)',
      '  → 2026-02-12 auth-jwt-migration (1h20, $5.80)',
      '  → 2026-02-10 fix-auth-token-refresh (20min, $0.90)',
    ],
  },
  {
    command: 'ccboard stats',
    output: [
      '  Sessions: 847 │ Total cost: $42.18',
      '  Models: opus-4 (62%), sonnet-4 (35%), haiku (3%)',
      '  Avg session: 23min │ Cache: 224ms startup',
    ],
  },
  {
    command: 'ccboard web --port 3333',
    output: [
      '  Web server started on http://localhost:3333',
      '  SSE connected: live updates enabled',
      '  9 pages available │ Open in browser →',
    ],
  },
]
---

<section class="py-12 md:py-16">
  <div class="mx-auto max-w-content px-4">
    <div class="max-w-2xl mx-auto">
      <div class="terminal-window bg-background border border-border rounded-lg overflow-hidden shadow-sm">
        <!-- Title bar -->
        <div class="flex items-center gap-2 px-4 py-2.5 bg-background-tertiary border-b border-border">
          <span class="w-3 h-3 rounded-full opacity-80" style="background: var(--status-danger)"></span>
          <span class="w-3 h-3 rounded-full opacity-80" style="background: var(--status-warning)"></span>
          <span class="w-3 h-3 rounded-full opacity-80" style="background: var(--status-success)"></span>
          <span class="ml-2 text-xs text-text-muted font-mono">terminal</span>
        </div>

        <!-- Terminal content -->
        <div class="p-4 font-mono text-sm min-h-[160px]">
          <div id="terminal-prompt" class="flex items-center gap-1">
            <span style="color: var(--status-success)">$</span>
            <span id="terminal-cmd" class="text-text-primary"></span>
            <span id="terminal-cursor" class="terminal-cursor"></span>
          </div>
          <div id="terminal-output" class="mt-2 text-text-secondary text-xs leading-relaxed"></div>
        </div>
      </div>
    </div>

    <!-- Noscript fallback -->
    <noscript>
      <div class="max-w-2xl mx-auto mt-4 rounded-lg overflow-hidden shadow-sm">
        <img src="/assets/demo.gif" alt="ccboard TUI demo" class="w-full" loading="lazy" />
      </div>
    </noscript>
  </div>
</section>

<style>
  .terminal-cursor {
    display: inline-block;
    width: 8px;
    height: 16px;
    background: var(--accent);
    animation: blink 1s step-end infinite;
    vertical-align: text-bottom;
    margin-left: 1px;
  }

  @keyframes blink {
    0%, 100% { opacity: 1; }
    50% { opacity: 0; }
  }
</style>

<script define:vars={{ scenes }}>
  const cmdEl = document.getElementById('terminal-cmd')
  const outputEl = document.getElementById('terminal-output')
  if (!cmdEl || !outputEl) throw new Error('Terminal elements not found')

  let sceneIndex = 0

  async function sleep(ms) {
    return new Promise(r => setTimeout(r, ms))
  }

  async function typeText(el, text, speed = 40) {
    el.textContent = ''
    for (const char of text) {
      el.textContent += char
      await sleep(speed)
    }
  }

  async function showOutput(lines) {
    outputEl.innerHTML = ''
    for (const line of lines) {
      await sleep(200)
      const div = document.createElement('div')
      div.textContent = line
      outputEl.appendChild(div)
    }
  }

  async function runScene() {
    const scene = scenes[sceneIndex]
    outputEl.innerHTML = ''
    await typeText(cmdEl, scene.command)
    await sleep(300)
    await showOutput(scene.output)
    await sleep(4000)
    sceneIndex = (sceneIndex + 1) % scenes.length
    runScene()
  }

  // Start after a short delay
  sleep(500).then(runScene)
</script>
